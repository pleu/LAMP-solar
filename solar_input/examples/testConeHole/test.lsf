selectall; 
delete; 
load("InputVariables.mat"); 
rTopValue = rtop; 
rBottomValue = rbot; 
zSpanValue = H; 
addstructuregroup; 
adduserprop("material",5,"etch"); 
adduserprop("r top",2,rTopValue); 
adduserprop("r bottom",2,rBottomValue); 
adduserprop("z span",2,zSpanValue); 
set("x", 0);
set("y", 0);
set("z", 0);
set("Script", 'deleteall;
 r_top = %r top%;
 r_bottom = %r bottom%;
 z_span = %z span%;
r_top = r_top +1e-20;
 ?theta=atan((r_bottom-r_top)/z_span);
?ht=r_top/tan(theta);
 addcustom;
set("x",0);
 set("y",0);
set("z",0);
set("first axis","y");
 set("rotation 1",90);
 set("x span",z_span);
 set("y span",2*max([r_bottom, r_top]));
set("z span",2*max([r_bottom, r_top]));
 set("name","cone");
set("create 3D object by","revolution");
?eqn = num2str(r_top/ht)+"*(x+"+num2str((z_span/2+ht)*1e6)+")";
set("equation 1",eqn);
set("material",material);
 if(get("material")=="<Object defined dielectric>"){ set("index",index);}');
set("first axis", 'none');
set("second axis", 'none');
set("third axis", 'none');
addrect; 
set("x", 0);
set("x span", 1e-06);
set("y", 0);
set("y span", 1e-06);
set("z", 0);
set("z span", 1e-06);
set("material", 'Si (Silicon) - Palik');
set("override mesh order from material database", 0);
set("grid attribute name", '');
set("first axis", 'none');
set("second axis", 'none');
set("third axis", 'none');
set("render type", 'detailed');
set("detail", 0.5);
set("override color opacity from material database", 1);
set("alpha", 0.9);
addplane; 
set("source shape", 'Plane wave');
set("amplitude", 1);
set("phase", 0);
set("injection axis", 'z-axis');
set("direction", 'Backward');
set("angle theta", 0);
set("angle phi", 0);
set("polarization angle", 0);
set("x", 0);
set("x span", 6.1091e-06);
set("y", 0);
set("y span", 3e-06);
set("z", 1e-08);
set("wavelength start", 4e-07);
set("wavelength stop", 2e-06);
addfdtd; 
set("dimension", '3D');
set("background index", 1);
set("simulation time", 1e-12);
set("x", 0);
set("x span", 0);
set("y", 0);
set("y span", 0);
set("z", 0);
set("z span", 6e-07);
set("mesh type", 'auto non-uniform');
set("mesh accuracy", 4);
set("mesh refinement", 'staircase');
set("dt stability factor", 0.99);
set("min mesh step", 2e-08);
set("allow symmetry on all boundaries", 1);
set("x min bc", 'Periodic');
set("y min bc", 'Periodic');
set("z min bc", 'PML');
set("z max bc", 'PML');
set("pml reflection", 0.0001);
set("force symmetric x mesh", 0);
set("force symmetric y mesh", 0);
set("force symmetric z mesh", 0);
set("override simulation bandwidth for mesh generation", 0);
set("snap pec to yee cell boundary", 0);
set("always use complex fields", 0);
set("use early shutoff", 1);
set("auto shutoff min", 1e-05);
set("use divergence checking", 1);
set("auto shutoff max", 100000);
set("down sample time", 100);
set("pml kappa", 2);
set("pml sigma", 0.25);
set("minimum pml layers", 12);
set("maximum pml layers", 64);
set("pml polynomial", 3);
set("type of pml", 'standard');
set("max source time signal length", 32768);
set("Set process grid", 0);
addpower; 
set("simulation type", 'All');
set("override global monitor settings", 1);
set("use source limits", 1);
set("use linear wavelength spacing", 0);
set("frequency points", 1000);
set("spatial interpolation", 'nearest mesh cell');
set("override advanced global monitor settings", 0);
set("standard fourier transform", 1);
set("partial spectral average", 0);
set("total spectral average", 0);
set("output Ex", 1);
set("output Ey", 1);
set("output Ez", 1);
set("output Hx", 1);
set("output Hy", 1);
set("output Hz", 1);
set("output Px", 0);
set("output Py", 0);
set("output Pz", 0);
set("output power", 1);
set("monitor type", '2D Z-normal');
set("x", 0);
set("y", 0);
set("z", 2e-07);
set("x span", 3e-06);
set("down sample X", 1);
set("y span", 3e-06);
set("down sample Y", 1);
set("delta", 10000000000000);
set("apodization", 'None');
addpower; 
set("simulation type", 'All');
set("override global monitor settings", 1);
set("use source limits", 1);
set("use linear wavelength spacing", 0);
set("frequency points", 1000);
set("spatial interpolation", 'nearest mesh cell');
set("override advanced global monitor settings", 0);
set("standard fourier transform", 1);
set("partial spectral average", 0);
set("total spectral average", 0);
set("output Ex", 1);
set("output Ey", 1);
set("output Ez", 1);
set("output Hx", 1);
set("output Hy", 1);
set("output Hz", 1);
set("output Px", 0);
set("output Py", 0);
set("output Pz", 0);
set("output power", 1);
set("monitor type", '2D Z-normal');
set("x", 0);
set("y", 0);
set("z", 2e-07);
set("x span", 3e-06);
set("down sample X", 1);
set("y span", 3e-06);
set("down sample Y", 1);
set("delta", 10000000000000);
set("apodization", 'None');
save("test1"); 
run; 
frequencyTransmission = getdata("monitor_1","f"); 
transmissionData = -transmission("monitor_1"); 
dataTransmission = [transpose(frequencyTransmission); transpose(transmissionData)]; 
write("ThinFilmHole"+"Transmission.txt",num2str(dataTransmission));
reflectionData = transmission("monitor"); 
dataReflection = [transpose(frequencyTransmission); transpose(reflectionData)]; 
write("ThinFilmHole"+"Reflection.txt",num2str(dataReflection)); 
 
exit; 
